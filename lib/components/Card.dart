import 'package:flutter/material.dart';import 'package:flutter/services.dart';import 'package:flutter_riverpod/flutter_riverpod.dart';import 'package:flutter_tts/flutter_tts.dart';import 'package:hi/Providers/path_provier/data_provider.dart';import 'package:percent_indicator/linear_percent_indicator.dart';import 'package:quickalert/quickalert.dart';import 'package:quickalert/widgets/quickalert_buttons.dart';import 'package:speech_to_text/speech_to_text.dart';class Cardp extends ConsumerStatefulWidget {  // final Function(int) setLayer;  // final int layer;  final VoidCallback onNext;  // final String data;  Cardp({required this.onNext,    // required this.data  });  // const Card({  //   Key? key,  //   required this.setLayer,  //   required this.layer,  // }) : super(key: key);  @override  ConsumerState<Cardp> createState() => _CardpState();}class _CardpState extends ConsumerState<Cardp> {  final SpeechToText _speechToText = SpeechToText();  var info;  var unique_sentence;late final List<Map<String,dynamic>> Unique_word = [    {      'english_word':unique_sentence[0]['english_word'],      'hindi_meaning':unique_sentence[0]['hindi_mean'],    }  ];  late var english_word = Unique_word[0]['english_word'];  late var hindi_word = Unique_word[0]['hindi_meaning'];  var speaking_word = "";  bool _speechEnabled = false;  String _wordsSpoken = " ";  double _confidenceLevel = 0;  bool _sucessfull = false;  String dd = "done";  FlutterTts flutterTts  = FlutterTts();  Future _speak() async {    await flutterTts.setLanguage("hi");    await flutterTts.setPitch(5);    await flutterTts.speak(hindi_word);  }  @override  void initState() {    // TODO: implement initState    super.initState();    initSpeech();    _speak();    final data =  ref.read(Path_data).data;    info = data;    var extract_data = info['Speaking_word'];    unique_sentence= extract_data;  }  void initSpeech() async {    _speechEnabled =  await _speechToText.initialize();    setState(() {    });  }  void _startListening() async{    await _speechToText.listen(onResult: _onSpeechResult);  }  void _onSpeechResult(result){    // print(result.recognizedWords);    var storage = result.recognizedWords;    setState(() {      speaking_word = storage;    });    // setState(() {    //   _wordsSpoken = "${result.recognizedWords}";    //   _confidenceLevel = result.confidence;    // });    if(storage == english_word.toLowerCase()){      print("perfect");     widget.onNext();      // QuickAlert.show(      //   context: context,      //   type: QuickAlertType.success,      //   text: 'Transaction Completed Successfully!',      // );      // setState(() {      //      //   _sucessfull = true;      // });    }    // else{    //   showDialog(    //     context: context,    //     builder: (BuildContext context) {    //       return AlertDialog(    //         backgroundColor: Color(0xFF2A2A2A),    //         title: Row(    //           children: [    //             Icon(    //                Icons.cancel,    //               color: Colors.red,    //             ),    //             SizedBox(width: 8),    //             Text(    //                'Incorrect',    //               style: TextStyle(    //                 color: Colors.red,    //               ),    //             ),    //           ],    //         ),    //         content: Text(    //           'Please speak clear correct word,${english_word} with confidence ,Try again'    //         ,    //           style: TextStyle(color: Colors.white70),    //         ),    //         actions: [    //           TextButton(    //             onPressed: () {    //               Navigator.pop(context);    //               // Move to next question or handle completion    //             },    //             child: Text(    //               'Continue',    //               style: TextStyle(color: Color(0xFF00BCD4)),    //             ),    //           ),    //           TextButton(    //             onPressed: () {    //               Navigator.pop(context);    //               widget.onNext();    //               // Move to next question or handle completion    //             },    //             child: Text(    //               'Next',    //               style: TextStyle(color: Color(0xFF00BCD4)),    //             ),    //           ),    //         ],    //    //       );    //     },    //   );    // }  }  void _stopListening() async {    await _speechToText.stop();    setState(() {      // dd="ho gay";      QuickAlert.show(        context: context,        type: QuickAlertType.error,        title: 'Oops...',        text: 'Sorry, something went wrong',      );    });  }  @override  Widget build(BuildContext context) {    // Get screen dimensions    final screenWidth = MediaQuery.of(context).size.width;    final cardWidth = screenWidth * 0.8;    final cardAspectRatio = 1.4; // Standard playing card aspect ratio    final cardHeight = cardWidth * cardAspectRatio;    // Calculate sizes proportional to card dimensions    final cornerSize = cardWidth * 0.15;    final centerSize = cardWidth * 0.3;    return Scaffold(      body: Column(        children: [          // Header with back button, progress bar and menu button          Container(            width: double.infinity,            color: Colors.black,            child: SafeArea(              bottom: false,              child: Padding(                padding: const EdgeInsets.symmetric(horizontal: 20.0, vertical: 10.0),                child: Row(                  mainAxisAlignment: MainAxisAlignment.spaceBetween,                  children: [                    Container(                      width: 40,                      height: 40,                      decoration: BoxDecoration(                        color: Colors.white.withOpacity(0.2),                        borderRadius: BorderRadius.circular(20),                      ),                      child: const Icon(                        Icons.close_sharp,                        color: Colors.white,                        size: 24,                      ),                    ),                    Container(child:                    new LinearPercentIndicator(                      width: 250.0,                      lineHeight: 8.0,                      percent: 0.7,                      backgroundColor: Colors.white,                      progressColor: Colors.blue,                      barRadius: Radius.circular(10.0),                      animation: true,                      animationDuration: 1000,                      curve: Curves.easeInOut,                      animateFromLastPercent: true,                    ),                    ),                    Container(                      width: 40,                      height: 40,                      decoration: BoxDecoration(                        color: Colors.white.withOpacity(0.2),                        borderRadius: BorderRadius.circular(20),                      ),                      child: const Icon(                        Icons.grid_view,                        color: Colors.white,                        size: 24,                      ),                    ),                    // Back button                    // Progress indicators                    // Menu button                  ],                ),              ),            ),          ),          // Main content area with card          Expanded(            child: Container(              color: Colors.black,              width: double.infinity,              child: Center(                child: Container(                  width: cardWidth,                  height: cardHeight,                  decoration: BoxDecoration(                    color: Colors.black,                    borderRadius: BorderRadius.circular(10),                    border: Border.all(width: 2.0,color: Colors.yellow),                    boxShadow: [                      BoxShadow(                        color: Colors.black.withOpacity(0.25),                        blurRadius: 3.84,                        offset: const Offset(0, 2),                      ),                    ],                  ),                  child: Stack(                    children: [                      // Title of the card                      Positioned(                        left: cardWidth * 0.04,                        top: cardHeight * 0.05,                        child: const Text(                          'Speak English',                          style: TextStyle(                            color: Colors.white,                            fontSize: 24,                            fontWeight: FontWeight.bold,                            decoration: TextDecoration.underline,                          ),                        ),                      ),                      // Card content                      Positioned(                        top: cardHeight * 0.4,                        left: cardWidth * 0.05,                        child: Container(                          width: cardWidth * 0.9,                          child: Column(                            crossAxisAlignment: CrossAxisAlignment.start,                            children: [                              Text(english_word,                                style: TextStyle(                                  fontSize: 27,                                  fontWeight: FontWeight.bold,                                  color: Colors.white,                                ),                              ),                              const SizedBox(height: 10),                               Text(                               hindi_word,                                style: TextStyle(                                  fontSize: 17,                                  // color: Colors.grey,                                  color: Colors.white,                                ),                              ),                            ],                          ),                        ),                      ),                    ],                  ),                ),              ),            ),          ),          if(speaking_word.length > 2)             Container(            width: double.infinity,          // height: 70,          color: Colors.black,          child:   Center(            child: Container(  // child: QuickAlertButtons(options: options)),            child: Text('${speaking_word}',style: TextStyle(fontSize: 30,color: Colors.white),)),          ),          ) ,          // Bottom controls with speaker and mic buttons          Container(            color: Colors.black,            // width: double.infinity,            padding: const EdgeInsets.symmetric(vertical: 20),            child: Row(              mainAxisAlignment: MainAxisAlignment.center,              children: [                // Speaker button                Container(                  width: 59,                  height: 60,                  decoration: BoxDecoration(                    color: const Color(0xFF333333),                    borderRadius: BorderRadius.circular(27),                  ),                  child: IconButton(                    icon: const Icon(Icons.volume_up, color: Colors.white),                    onPressed: () {_speak();},                    iconSize: 22,                  ),                ),                const SizedBox(width: 40),                // Microphone button                Container(                  width: 75,                  height: 56,                  decoration: BoxDecoration(                    color: const Color(0xFFFF9500),                    borderRadius: BorderRadius.circular(36),                  ),                  child: IconButton(                    icon: const Icon(Icons.mic, color: Colors.white),                      onPressed: _speechToText.isListening ? _stopListening : _startListening,                    iconSize: 38,                  ),                ),                const SizedBox(width: 80),              ],            ),          ),        ],      ),    );  }  Widget _buildProgressIndicator(bool isActive) {    final screenWidth = MediaQuery.of(context).size.width;    final indicatorWidth = (screenWidth - 60) / 7;    return Container(      width: indicatorWidth,      height: 8,      decoration: BoxDecoration(        color: isActive            ? Colors.white            : Colors.white.withOpacity(0.3),        borderRadius: BorderRadius.circular(4),      ),    );  }}